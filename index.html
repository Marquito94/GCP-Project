<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Static Site â€“ Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:," />
</head>
<body style="font-family: system-ui, Arial; margin: 40px;">
  <h1>Welcome ðŸ‘‹</h1>
  <p>Three example paths that call a backend:</p>
  <ul>
    <li><a href="/solutions/">/solutions</a></li>
    <li><a href="/delivery/">/delivery</a></li>
    <li><a href="/status/">/status</a></li>
  </ul>
  <p>Each page will call <code>https://api.example.com</code> with a different path.</p>
</body>
</html>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  // Fetch runtime config (no cache)
  const cfg = await fetch("/config.json", { cache: "no-store" }).then(r => r.json());

  const app = initializeApp({
    apiKey: cfg.apiKey,
    authDomain: cfg.authDomain,
    projectId: cfg.projectId
  });

  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  async function ensureSignedIn() {
    if (!auth.currentUser) await signInWithPopup(auth, provider);
  }

  // Use this instead of fetch()
  window.authFetch = async (path, options = {}) => {
    await ensureSignedIn();
    const idToken = await auth.currentUser.getIdToken();
    const res = await fetch(`https://api.pueba-web-dev.com${path}`, {
      ...options,
      headers: { Accept: "application/json", Authorization: `Bearer ${idToken}`, ...(options.headers || {}) },
      credentials: "include",
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  };
</script>
